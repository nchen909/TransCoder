{"project": "FFmpeg", "commit_id": "bcaf64b605442e1622d16da89d4ec0e7730b8a8c", "target": 0, "func": "int AC3_NAME(encode_frame)(AVCodecContext *avctx, AVPacket *avpkt,\n\n                           const AVFrame *frame, int *got_packet_ptr)\n\n{\n\n    AC3EncodeContext *s = avctx->priv_data;\n\n    int ret;\n\n\n\n    if (s->options.allow_per_frame_metadata) {\n\n        ret = ff_ac3_validate_metadata(s);\n\n        if (ret)\n\n            return ret;\n\n    }\n\n\n\n    if (s->bit_alloc.sr_code == 1 || s->eac3)\n\n        ff_ac3_adjust_frame_size(s);\n\n\n\n    copy_input_samples(s, (SampleType **)frame->extended_data);\n\n\n\n    apply_mdct(s);\n\n\n\n    if (s->fixed_point)\n\n        scale_coefficients(s);\n\n\n\n    clip_coefficients(&s->dsp, s->blocks[0].mdct_coef[1],\n\n                      AC3_MAX_COEFS * s->num_blocks * s->channels);\n\n\n\n    s->cpl_on = s->cpl_enabled;\n\n    ff_ac3_compute_coupling_strategy(s);\n\n\n\n    if (s->cpl_on)\n\n        apply_channel_coupling(s);\n\n\n\n    compute_rematrixing_strategy(s);\n\n\n\n    if (!s->fixed_point)\n\n        scale_coefficients(s);\n\n\n\n    ff_ac3_apply_rematrixing(s);\n\n\n\n    ff_ac3_process_exponents(s);\n\n\n\n    ret = ff_ac3_compute_bit_allocation(s);\n\n    if (ret) {\n\n        av_log(avctx, AV_LOG_ERROR, \"Bit allocation failed. Try increasing the bitrate.\\n\");\n\n        return ret;\n\n    }\n\n\n\n    ff_ac3_group_exponents(s);\n\n\n\n    ff_ac3_quantize_mantissas(s);\n\n\n\n    if ((ret = ff_alloc_packet2(avctx, avpkt, s->frame_size)))\n\n        return ret;\n\n    ff_ac3_output_frame(s, avpkt->data);\n\n\n\n    if (frame->pts != AV_NOPTS_VALUE)\n\n        avpkt->pts = frame->pts - ff_samples_to_time_base(avctx, avctx->delay);\n\n\n\n    *got_packet_ptr = 1;\n\n    return 0;\n\n}\n", "idx": 11278}

